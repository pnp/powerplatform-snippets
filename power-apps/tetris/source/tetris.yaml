- cont_tetris:
    Control: GroupContainer@1.3.0
    Variant: ManualLayout
    Properties:
      ContentLanguage: |-
        =// Steve BOURDIN D√©cembre 2025 - MOCA by ASI
        ""
      DropShadow: =DropShadow.None
      Height: =Parent.Height
      Width: =Parent.Width
    Children:
      - img_fond:
          Control: Image@2.2.3
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Height: =Parent.Height
            Image: ="https://png.pngtree.com/thumb_back/fh260/background/20230527/pngtree-tetris-wallpaper-hd-1080p-image_2693812.jpg"
            ImagePosition: =ImagePosition.Fill
            Width: =Parent.Width
      - cont_body:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            Height: =Parent.Height
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutDirection: =LayoutDirection.Horizontal
            PaddingBottom: =8
            PaddingLeft: =8
            PaddingRight: =8
            PaddingTop: =8
            Width: =Parent.Width
          Children:
            - cont_left:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =60
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMaxHeight: =0
                  LayoutMaxWidth: =0
                  LayoutMinHeight: =16
                  LayoutMinWidth: =16
                  PaddingBottom: =8
                  PaddingLeft: =8
                  PaddingRight: =8
                  PaddingTop: =8
                Children:
                  - cont_level:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 0.35)
                        BorderThickness: =6
                        Fill: =RGBA(255, 255, 255, 0.15)
                        FillPortions: =0
                        Height: =Parent.Height/8
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =Parent.Width/2
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =Parent.Width/2
                        Width: =Parent.Width/2
                      Children:
                        - txt_level_titre:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Center
                              Font: =Font.'Courier New'
                              FontColor: =RGBA(0, 255, 140, 1)
                              Height: =(Parent.Height-8)/2
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              Size: =30
                              Text: ="Level"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =Parent.Width
                        - txt_level_value:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Center
                              Font: =Font.'Courier New'
                              FontColor: =RGBA(0, 255, 140, 1)
                              Height: =(Parent.Height-8)/2
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              Size: =30
                              Text: =varNiveau
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =Parent.Width
                  - cont_score:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 0.35)
                        BorderThickness: =6
                        Fill: =RGBA(255, 255, 255, 0.15)
                        FillPortions: =0
                        Height: =Parent.Height/8
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =Parent.Width/2
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =Parent.Width/2
                        Width: =Parent.Width/2
                      Children:
                        - txt_score_titre:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Center
                              Font: =Font.'Courier New'
                              FontColor: =RGBA(0, 255, 140, 1)
                              Height: =(Parent.Height-8)/2
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              Size: =30
                              Text: ="Score"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =Parent.Width
                        - txt_score_value:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Center
                              Font: =Font.'Courier New'
                              FontColor: =RGBA(0, 255, 140, 1)
                              Height: =(Parent.Height-8)/2
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              Size: =30
                              Text: =varScore
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Semibold
                              Width: =Parent.Width
                  - btn_start:
                      Control: Button@0.0.45
                      Properties:
                        AccessibleLabel: ="Start Game"
                        BasePaletteColor: =RGBA(0, 255, 140, 0.15)
                        BorderColor: =RGBA(0, 255, 140, 0.60)
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =3
                        Font: =Font.'Courier New'
                        FontColor: =Color.White
                        FontSize: =30
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height/8
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =Parent.Width/2
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =Parent.Width/2
                        OnSelect: |+
                          =Set(
                              varEtatPartie,
                              "Begin"
                          );
                          Select(btn_init_game);
                          Set(
                              varEtatPartie,
                              "Start"
                          );


                          Set(varX, 4);
                          Set(varY, 1);
                          Set(varCurrentPiece, Last(Shuffle(col_model)));
                          Set(varCurrentColor, Last(Shuffle(col_color)));


                        Text: |-
                          ="START üéÆ"
                        Visible: =varEtatPartie<>"Start"&&varEtatPartie<>"Flash"&&varEtatPartie<>"Pause"
                        Width: =Parent.Width/2
                  - btn_pause:
                      Control: Button@0.0.45
                      Properties:
                        AccessibleLabel: ="Pause"
                        BasePaletteColor: =RGBA(0, 160, 230, 1)
                        BorderColor: =RGBA(0, 255, 140, 0.60)
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =3
                        Font: =Font.'Courier New'
                        FontColor: =Color.White
                        FontSize: =30
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height/8
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =Parent.Width/2
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =Parent.Width/2
                        OnSelect: |-
                          =If(varEtatPartie<>"Pause", Set(
                              varEtatPartie,
                              "Pause"
                          ),Set(
                              varEtatPartie,
                              "Start"
                          ))
                        Text: =If(varEtatPartie<>"Pause", "PAUSE ‚è∏Ô∏è","PLAY ‚èØÔ∏è")
                        Visible: =btn_start.Visible=false
                        Width: =Parent.Width/2
            - cont_middle:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  BorderColor: =RGBA(255, 255, 255, 1)
                  BorderThickness: =1
                  DropShadow: =DropShadow.None
                  Fill: =RGBA(0, 0, 0, 0.85)
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutMaxHeight: =0
                  LayoutMaxWidth: =0
                  LayoutMinHeight: =16
                  LayoutMinWidth: =16
                  PaddingBottom: =8
                  PaddingLeft: =8
                  PaddingRight: =8
                  PaddingTop: =8
                  RadiusBottomLeft: =20
                  RadiusBottomRight: =20
                  RadiusTopLeft: =20
                  RadiusTopRight: =20
                Children:
                  - cont_board:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        Height: =Parent.Height
                        LayoutMaxHeight: =0
                        LayoutMaxWidth: =0
                        LayoutMinHeight: =16
                        LayoutMinWidth: =16
                        Width: =Parent.Width
                      Children:
                        - gal_rows:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              AccessibleLabel: ="Game"
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =Parent.Height-Parent.PaddingBottom-Parent.PaddingTop
                              Items: =Sequence(20)
                              TabIndex: =0
                              TemplatePadding: =0
                              TemplateSize: =Self.Height/If(Self.AllItemsCount=0,1,Self.AllItemsCount)
                              Width: =Parent.Width-Parent.PaddingLeft-Parent.PaddingRight
                            Children:
                              - gal_col:
                                  Control: Gallery@2.15.0
                                  Variant: Horizontal
                                  Properties:
                                    AccessibleLabel: ="Game"
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Height: =Parent.TemplateHeight
                                    Items: =Filter(col_board,Y=ThisItem.Value)
                                    TabIndex: =0
                                    TemplatePadding: =0
                                    TemplateSize: =Parent.Width/If(Self.AllItemsCount=0,1,Self.AllItemsCount)
                                    Width: =Parent.TemplateWidth
                                  Children:
                                    - txt_brick:
                                        Control: Text@0.0.51
                                        Properties:
                                          BorderColor: |-
                                            =If(
                                                ThisItem.Filled = false,
                                                RGBA(
                                                    0,
                                                    0,
                                                    0,
                                                    0
                                                ),
                                                ColorFade(
                                                    LookUp(
                                                        col_color,
                                                        Nom = ThisItem.Color
                                                    ).Code,
                                                    0.3
                                                )
                                            )
                                          BorderStyle: =BorderStyle.Solid
                                          BorderThickness: |-
                                            =If(
                                                ThisItem.Filled = false,0,4)
                                          Fill: =If(ThisItem.Flash=true, Color.White, LookUp(col_color,Nom=ThisItem.Color).Code)
                                          Height: =Parent.TemplateHeight-2
                                          Text: =""
                                          Width: =Parent.TemplateWidth-2
                        - gal_block:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              AccessibleLabel: ="Block"
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =gal_rows.TemplateHeight*4
                              Items: =AddColumns(Sequence(4),RowBlock,Value)
                              TabIndex: =0
                              TemplatePadding: =0
                              TemplateSize: =Self.Height/If(Self.AllItemsCount=0,1,Self.AllItemsCount)
                              Visible: =varEtatPartie="Start" || varEtatPartie="Pause"
                              Width: |-
                                =//gal_col.TemplateWidth*4
                                (Parent.Width/5)*2
                              X: =varX*gal_col.TemplateWidth
                              Y: =varY*gal_rows.TemplateHeight
                            Children:
                              - gal_block_col:
                                  Control: Gallery@2.15.0
                                  Variant: Horizontal
                                  Properties:
                                    AccessibleLabel: ="Block"
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Height: =Parent.TemplateHeight
                                    Items: |-
                                      =AddColumns (
                                          AddColumns(
                                              Sequence(4),
                                              ColBlock,
                                              Value,
                                              RowBlock2 , ThisItem.RowBlock
                                          ),
                                          Data,
                                          LookUp(
                                              varCurrentPiece.Blocks,
                                              Y = RowBlock2&&
                                              X = ColBlock
                                          )
                                      )
                                    TabIndex: =0
                                    TemplatePadding: =0
                                    TemplateSize: =Self.Width/If(Self.AllItemsCount=0,1,Self.AllItemsCount)
                                    Width: =gal_block.TemplateWidth
                                  Children:
                                    - txt_block_unit:
                                        Control: Text@0.0.51
                                        Properties:
                                          BorderColor: |-
                                            =If(
                                                IsBlank(ThisItem.Data) = true,
                                                RGBA(
                                                    0,
                                                    0,
                                                    0,
                                                    0
                                                ),
                                                ColorFade(
                                                    varCurrentColor.Code,
                                                    0.3
                                                )
                                            )
                                          BorderStyle: =BorderStyle.Solid
                                          BorderThickness: |-
                                            =If(
                                                IsBlank(ThisItem.Data) = true,0,4)
                                          Fill: =If(IsBlank(ThisItem.Data)=true,RGBA(0,0,0,0), varCurrentColor.Code)
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =Parent.TemplateHeight-2
                                          Text: =""
                                          Width: =Parent.TemplateWidth-2
                        - img_press_start:
                            Control: Image@2.2.3
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =Parent.Height
                              Image: |+
                                ="data:image/svg+xml;utf8," &
                                EncodeUrl(
                                "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 60'>

                                  <style>
                                    .scroll-text {
                                      font-family: ""Segoe UI Black"", ""Arial Black"", Impact, system-ui, sans-serif;
                                      font-size: 28px;
                                      fill: #00B8FF;
                                    }
                                  </style>

                                  <text class='scroll-text' x='250' y='40' text-anchor='middle'>
                                    Press Start to Play
                                    <animateTransform
                                      attributeName='transform'
                                      type='translate'
                                      values='250 0; -250 0; 250 0'
                                      dur='8s'
                                      repeatCount='indefinite' />
                                  </text>

                                </svg>"
                                )
                              Visible: =varEtatPartie="Begin"
                              Width: =Parent.Width
                        - img_game_over:
                            Control: Image@2.2.3
                            Properties:
                              AccessibleLabel: ="GameOver"
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =Parent.Height
                              Image: |
                                ="data:image/svg+xml;utf8," &
                                EncodeUrl(
                                "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 150'>

                                  <style>
                                    .go-text {
                                      font-family: ""Segoe UI Black"", ""Arial Black"", Impact, system-ui, sans-serif;
                                      font-size: 90px;
                                      text-anchor: middle;
                                      fill: #FF3B3B;
                                      letter-spacing: 6px;
                                    }

                                    .go-glow {
                                      fill: none;
                                      stroke: #FF3B3B;
                                      stroke-width: 2;
                                      filter: drop-shadow(0 0 8px #FF3B3B);
                                    }
                                  </style>

                                  <text x='300' y='95' class='go-text go-glow'>GAME OVER</text>
                                  <text x='300' y='95' class='go-text'>GAME OVER</text>

                                </svg>"
                                )
                              TabIndex: =0
                              Visible: =varEtatPartie="GameOver"
                              Width: =Parent.Width
            - cont_right:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =20
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMaxHeight: =0
                  LayoutMaxWidth: =0
                  LayoutMinHeight: =16
                  LayoutMinWidth: =16
                  PaddingBottom: =8
                  PaddingLeft: =8
                  PaddingRight: =8
                  PaddingTop: =8
                Children:
                  - cont_titre_tetris:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 1)
                        BorderThickness: =3
                        Fill: =RGBA(0, 180, 255, 0.22)
                        Height: =Parent.Height/8
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =60
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =0
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =16
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Width: =3*Parent.Width/4
                      Children:
                        - img_titre_tetris:
                            Control: Image@2.2.3
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =Parent.Height
                              Image: "=\"data:image/svg+xml;utf8,\" &\r\nEncodeUrl(\r\n\"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 420 120'>\r\n\r\n  <defs>\r\n    <linearGradient id='rainbow' x1='-100%' y1='0%' x2='200%' y2='0%'>\r\n      <stop offset='0%'   stop-color='#ff0000'/>\r\n      <stop offset='20%'  stop-color='#ff7f00'/>\r\n      <stop offset='40%'  stop-color='#ffff00'/>\r\n      <stop offset='60%'  stop-color='#00ff00'/>\r\n      <stop offset='80%'  stop-color='#0000ff'/>\r\n      <stop offset='100%' stop-color='#8b00ff'/>\r\n\r\n      <animate attributeName='x1' values='-100%;100%' dur='10s' repeatCount='indefinite'/>\r\n      <animate attributeName='x2' values='0%;200%' dur='10s' repeatCount='indefinite'/>\r\n    </linearGradient>\r\n  </defs>\r\n\r\n  \r\n\r\n  <text x='50%' y='80'\r\n        text-anchor='middle'\r\n        font-family='Segoe UI Black, Arial Black, Impact, system-ui, sans-serif'\r\n        font-size='72'\r\n        letter-spacing='4'\r\n        fill='url(#rainbow)'\r\n        opacity='0.45'>\r\n    TETRIS\r\n  </text>\r\n\r\n</svg>\"\r\n)\r\n"
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =Parent.Width
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |-
                                =//Hack Button :D :D
                                Set(varScore,5000)
                              Width: =Parent.Width
                  - cont_btn_left_right:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 1)
                        BorderThickness: =3
                        Fill: =RGBA(0, 180, 255, 0.22)
                        Height: =Parent.Height/4
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =60
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        LayoutMaxHeight: =Parent.Height/4
                        LayoutMaxWidth: =0
                        LayoutMinHeight: =Parent.Height/4
                        LayoutMinWidth: =16
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Width: =3*Parent.Width/4
                      Children:
                        - btn_left:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Left"
                              BorderColor: =RGBA(255, 255, 255, 1)
                              BorderRadius: =30
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =3
                              FontSize: =80
                              Height: =Self.Width
                              Icon: ="ChevronLeft"
                              Layout: ='ButtonCanvas.Layout'.IconOnly
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |+
                                =If(
                                    // Aucun bloc ne d√©passe le bord gauche
                                    CountRows(
                                        Filter(
                                            varCurrentPiece.Blocks As b,
                                            varX + b.X - 1 < 1
                                        )
                                    ) = 0
                                    &&
                                    // Aucun bloc ne touche un bloc d√©j√† fix√©
                                    Sum(
                                        ForAll(
                                            varCurrentPiece.Blocks As b,
                                            If(LookUp(
                                                col_board,
                                                X = varX + b.X - 1 &&
                                                Y = varY + b.Y
                                            ).Filled = true,1,0)
                                        ),Value
                                    ) = 0,

                                    // D√©placement autoris√©
                                    Set(varX, varX - 1)
                                )
                        - btn_right:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Right"
                              BorderColor: =RGBA(255, 255, 255, 1)
                              BorderRadius: =30
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =3
                              FontSize: =80
                              Height: =Self.Width
                              Icon: ="ChevronRight"
                              Layout: ='ButtonCanvas.Layout'.IconOnly
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |+
                                =If(
                                    // Aucun bloc ne d√©passe le bord droit
                                    CountRows(
                                        Filter(
                                            varCurrentPiece.Blocks As b,
                                            varX + b.X + 1 > 10
                                        )
                                    ) = 0
                                    &&
                                    // Aucun bloc ne touche un bloc d√©j√† fix√©
                                    Sum(
                                        ForAll(
                                            varCurrentPiece.Blocks As b,
                                            If(LookUp(
                                                col_board,
                                                X = varX + b.X + 1 &&
                                                Y = varY + b.Y&&Filled=true
                                            ).Filled,1,0)
                                        ),Value
                                    ) = 0,

                                    // D√©placement autoris√©
                                    Set(varX, varX + 1)
                                )
                  - cont_btn_down_rotate:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 1)
                        BorderThickness: =3
                        Fill: =RGBA(0, 180, 255, 0.22)
                        Height: =Parent.Height/4
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =60
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        LayoutMaxHeight: =Parent.Height/4
                        LayoutMaxWidth: =0
                        LayoutMinHeight: =Parent.Height/4
                        LayoutMinWidth: =16
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Width: =3*Parent.Width/4
                      Children:
                        - btn_down:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Down"
                              BorderColor: =RGBA(255, 255, 255, 1)
                              BorderRadius: =30
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =3
                              FontSize: =80
                              Height: =Self.Width
                              Icon: ="ChevronDown"
                              Layout: ='ButtonCanvas.Layout'.IconOnly
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |-
                                =// Test : est-ce que la pi√®ce peut descendre ?
                                If(
                                    // 1. Aucun bloc ne d√©passe le bas
                                    CountRows(
                                        Filter(
                                            varCurrentPiece.Blocks As b,
                                            varY + b.Y + 2 > 20
                                        )
                                    ) = 0 &&
                                    // 2. Aucun bloc ne touche un bloc d√©j√† fix√©
                                 Sum(
                                        ForAll(
                                            varCurrentPiece.Blocks As b,
                                            If(
                                                LookUp(
                                                    col_board,
                                                    X = varX + b.X && Y = varY + b.Y + 2
                                                ).Filled = true,
                                                1,
                                                0
                                            )
                                        ),Value
                                    ) = 0,
                                    //  Si tout est OK ‚Üí on descend
                                    Set(
                                        varY,
                                        varY + 2
                                    )
                                )
                        - btn_rotate:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Rotate"
                              BasePaletteColor: =RGBA(8, 222, 8, 1)
                              BorderColor: =RGBA(255, 255, 255, 1)
                              BorderRadius: =60
                              BorderStyle: =BorderStyle.Solid
                              BorderThickness: =3
                              FontSize: =40
                              Height: =Self.Width
                              Icon: ="ArrowReset"
                              Layout: ='ButtonCanvas.Layout'.IconOnly
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |
                                =// Rotation 90¬∞ horaire
                                Set(
                                    varBlocsRotes,
                                    ForAll(
                                        varCurrentPiece.Blocks,
                                        {
                                            X: Y,
                                            Y: 5 - X
                                        }
                                    )
                                );

                                // Recentrage dans la matrice 1‚Äì4
                                Set(varMinX, Min(varBlocsRotes, X));
                                Set(varMinY, Min(varBlocsRotes, Y));

                                Set(
                                    varBlocsRotes,
                                    ForAll(
                                        varBlocsRotes,
                                        {
                                            X: X - varMinX + 1,
                                            Y: Y - varMinY + 1
                                        }
                                    )
                                );

                                // Fonction utilitaire : teste collision pour un d√©calage donn√©
                                Set(
                                    varTestCollision,
                                    With(
                                        {dx: 0},
                                        Sum(
                                            varBlocsRotes As b,
                                            If(
                                                LookUp(
                                                    col_board,
                                                    X = varX + dx + b.X &&
                                                    Y = varY + b.Y
                                                ).Filled,
                                                1,
                                                0
                                            )
                                        )
                                    )
                                );

                                // Test rotation directe
                                Set(
                                    varCollisionDirecte,
                                    Sum(
                                        varBlocsRotes As b,
                                        If(
                                            LookUp(
                                                col_board,
                                                X = varX + b.X &&
                                                Y = varY + b.Y
                                            ).Filled,
                                            1,
                                            0
                                        )
                                    ) > 0
                                );

                                // Test rotation + d√©calage droite
                                Set(
                                    varCollisionDroite,
                                    Sum(
                                        varBlocsRotes As b,
                                        If(
                                            LookUp(
                                                col_board,
                                                X = varX + 1 + b.X &&
                                                Y = varY + b.Y
                                            ).Filled,
                                            1,
                                            0
                                        )
                                    ) > 0
                                );

                                // Test rotation + d√©calage gauche
                                Set(
                                    varCollisionGauche,
                                    Sum(
                                        varBlocsRotes As b,
                                        If(
                                            LookUp(
                                                col_board,
                                                X = varX - 1 + b.X &&
                                                Y = varY + b.Y
                                            ).Filled,
                                            1,
                                            0
                                        )
                                    ) > 0
                                );

                                // Application de la rotation avec wall kick
                                If(
                                    // Cas 1 : rotation directe OK
                                    !varCollisionDirecte,
                                    Set(varCurrentPiece, Patch(varCurrentPiece, {Blocks: varBlocsRotes})),

                                    // Cas 2 : rotation + d√©calage droite OK
                                    !varCollisionDroite,
                                    Set(varX, varX + 1),
                                    Set(varCurrentPiece, Patch(varCurrentPiece, {Blocks: varBlocsRotes})),

                                    // Cas 3 : rotation + d√©calage gauche OK
                                    !varCollisionGauche,
                                    Set(varX, varX - 1),
                                    Set(varCurrentPiece, Patch(varCurrentPiece, {Blocks: varBlocsRotes}))
                                );
                  - cont_moca:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(255, 255, 255, 1)
                        BorderThickness: =3
                        Fill: =RGBA(0, 180, 255, 0.22)
                        Height: =Parent.Height/8
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =60
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        LayoutMaxHeight: =Parent.Height/8
                        LayoutMaxWidth: =Parent.Width/2
                        LayoutMinHeight: =Parent.Height/8
                        LayoutMinWidth: =Parent.Width/2
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        RadiusBottomLeft: =20
                        RadiusBottomRight: =20
                        RadiusTopLeft: =20
                        RadiusTopRight: =20
                        Width: =Parent.Width/2
                      Children:
                        - img_moca:
                            Control: Image@2.2.3
                            Properties:
                              AccessibleLabel: ="MOCA"
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Image: ="https://www.asi.fr/sites/default/files/styles/full_desktop_1x/public/2022-02/LOGO_MOCA_CP.jpg.webp?itok=qxVUdiu9"
                              LayoutMaxHeight: =0
                              LayoutMaxWidth: =0
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |+
                                =Launch(
                                    "https://www.linkedin.com/company/moca-byasi/?originalSubdomain=fr"
                                )
                              TabIndex: =0
                              Width: =Parent.Width
      - tim_init_game:
          Control: Timer@2.1.0
          Group: grp_timers
          Properties:
            AutoStart: =true
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnTimerStart: |-
              =Set(
                  varEtatPartie,
                  "Begin"
              );
              Select(btn_init_game)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =true
            Visible: =false
            Y: =728
      - tim_descente:
          Control: Timer@2.1.0
          Group: grp_timers
          Properties:
            AutoStart: =varEtatPartie="Start"
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: |-
              =Switch(
                  varNiveau,
                  1,
                  1000,
                  2,
                  900,
                  3,
                  800,
                  4,
                  700,
                  5,
                  600,
                  6,
                  500,
                  7,
                  400,
                  8,
                  300,
                  9,
                  200,
                  10,
                  100
              )
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnTimerEnd: "=// 1. V√©rifier collision vers le bas\nSet(\n    varCollisionBas,\n    Sum(\n        varCurrentPiece.Blocks As b,\n        If(\n            LookUp(\n                col_board,\n                X = varX + b.X && Y = varY + b.Y + 1\n            ).Filled,\n            1,\n            0\n        )\n    ) > 0 || Max(\n        ForAll(\n            varCurrentPiece.Blocks,\n            varY + Y\n        ),\n        Value\n    ) >= 20\n);\n// 2. Si pas de collision ‚Üí descendre\nIf(\n    !varCollisionBas,\n    Set(\n        varY,\n        varY + 1\n    ),\n// 3. Sinon ‚Üí fixer la pi√®ce\n    ForAll(\n        varCurrentPiece.Blocks As b,\n        Patch(\n            col_board,\n            LookUp(\n                col_board,\n                X = varX + b.X && Y = varY + b.Y\n            ),\n            {\n                Filled: true,\n                Color: varCurrentColor.Nom\n            }\n        )\n    );\n    // 4. Nouvelle pi√®ce\n    Set(\n        varX,\n        4\n    );\n    Set(\n        varY,\n        1\n    );\n    Set(\n        varCurrentPiece,\n        Last(Shuffle(col_model))\n    );\n    Set(\n        varCurrentColor,\n        Last(Shuffle(col_color))\n    );\n    // Test si la zone de spawn est bloqu√©e\n    If(\n        Sum(\n            ForAll(\n                varCurrentPiece.Blocks As b,\n                If(\n                    LookUp(\n                        col_board,\n                        X = varX + b.X && Y = varY + b.Y\n                    ).Filled = true,\n                    1,\n                    0\n                )\n            ),\n            Value\n        ) > 0,\n    // Game Over\n        Set(\n            varEtatPartie,\n            \"GameOver\"\n        )\n    )\n);\n// 1. D√©tection des lignes compl√®tes\nClearCollect(\n    col_lignes_completes,\n    ForAll(\n        Sequence(20) As Row,\n        If(\n            CountRows(\n                Filter(\n                    col_board,\n                    Y = Row.Value && Filled = true\n                )\n            ) = 10,\n            {Y: Row.Value}\n        )\n    )\n);\n// Si aucune ligne ‚Üí fin\nIf(\n    CountRows(col_lignes_completes) = 0,\n    false,\n    ForAll(\n        col_lignes_completes As L,\n        UpdateIf(\n            col_board,\n            Y = L.Y,\n            {Flash: true}\n        )\n    );\n    Set(\n        varEtatPartie,\n        \"Flash\"\n    );\n    \n)"
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Repeat: =true
            Start: =varEtatPartie="Start"
            Visible: =false
            X: =40
            Y: =40
      - tim_flash:
          Control: Timer@2.1.0
          Group: grp_timers
          Properties:
            AutoStart: =varEtatPartie="Flash"
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: =100
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnTimerEnd: |+
              =
              ClearCollect(
                  col_board_tmp,
                  col_board
              );
              //Pour chaque ligne compl√®te, on va supprimer la ligne et redescendre les lignes au dessus puis ins√©rer une ligne vide en premier
              ForAll(
                  col_lignes_completes As L,
                  RemoveIf(
                      col_board_tmp,
                      Y = L.Y
                  );
                  UpdateIf(
                      col_board_tmp,
                      Y < L.Y,
                      {Y: Y + 1}
                  );
                  ForAll(
                      Sequence(10) As Col,
                      Collect(
                          col_board_tmp,
                          {
                              X: Col.Value,
                              Y: 1,
                              Filled: false
                          }
                      )
                  )
              );
              ClearCollect(
                  col_board,
                  col_board_tmp
              );
              Set(
                  varScore,
                  varScore + Switch(
                      CountRows(col_lignes_completes),
                      1,
                      100,
                      2,
                      300,
                      3,
                      500,
                      4,
                      800
                  )
              );
              Set(
                  varNiveau,
                  Min(
                      10,
                      RoundDown(
                          varScore / 500,
                          0
                      ) + 1
                  )
              );
              Set(varEtatPartie,"Start")
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =varEtatPartie="Flash"
            Visible: =false
            X: =60
            Y: =60
      - btn_init_game:
          Control: Button@0.0.45
          Properties:
            AccessibleLabel: ="InitGame"
            OnSelect: |+
              =//Variable de partie

              Set(
                  varScore,
                  0
              );
              Set(
                  varNiveau,
                  1
              );
              //Collection de type de pi√®ce
              ClearCollect(
                  col_model,
                  // I (ligne horizontale)
                  {
                      Name: "I",
                      Blocks: [
                          {
                              X: 1,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 4,
                              Y: 2
                          }
                      ]
                  },
                  // O (carr√©)
                  {
                      Name: "O",
                      Blocks: [
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 3
                          },
                          {
                              X: 3,
                              Y: 3
                          }
                      ]
                  },
                  // T
                  {
                      Name: "T",
                      Blocks: [
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 1,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 1
                          }
                      ]
                  },
                  // S
                  {
                      Name: "S",
                      Blocks: [
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 1,
                              Y: 1
                          },
                          {
                              X: 2,
                              Y: 1
                          }
                      ]
                  },
                  // Z
                  {
                      Name: "Z",
                      Blocks: [
                          {
                              X: 1,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 1
                          },
                          {
                              X: 3,
                              Y: 1
                          }
                      ]
                  },
                  // J
                  {
                      Name: "J",
                      Blocks: [
                          {
                              X: 1,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 1,
                              Y: 1
                          }
                      ]
                  },
                  // L
                  {
                      Name: "L",
                      Blocks: [
                          {
                              X: 1,
                              Y: 2
                          },
                          {
                              X: 2,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 2
                          },
                          {
                              X: 3,
                              Y: 1
                          }
                      ]
                  }
              );
              //Les couleurs
              ClearCollect(
                  col_color,
                  {
                      Nom: "Cyan",
                      Code: RGBA(
                          0,
                          255,
                          255,
                          0.55
                      )
                  },
                  {
                      Nom: "Yellow",
                      Code: RGBA(
                          255,
                          255,
                          0,
                          0.55
                      )
                  },
                  {
                      Nom: "Purple",
                      Code: RGBA(
                          128,
                          0,
                          128,
                          0.55
                      )
                  },
                  {
                      Nom: "Green",
                      Code: RGBA(
                          0,
                          255,
                          0,
                          0.55
                      )
                  },
                  {
                      Nom: "Red",
                      Code: RGBA(
                          255,
                          0,
                          0,
                          0.55
                      )
                  },
                  {
                      Nom: "Blue",
                      Code: RGBA(
                          0,
                          0,
                          255,
                          0.55
                      )
                  },
                  {
                      Nom: "Orange",
                      Code: RGBA(
                          255,
                          165,
                          0,
                          0.55
                      )
                  }
              );
              //Tableau de jeu (20x10)
              ClearCollect(
                  col_board,
                  Blank()
              );
              ForAll(
                  Sequence(20) As Row,
                  ForAll(
                      Sequence(10) As Col,
                      Collect(
                          col_board,
                          {
                              X: Col.Value,
                              Y: Row.Value,
                              Filled: false,
                              Color: "",
                              Flash: false
                          }
                      )
                  )
              );
            Visible: =false
            X: =80
            Y: =80
